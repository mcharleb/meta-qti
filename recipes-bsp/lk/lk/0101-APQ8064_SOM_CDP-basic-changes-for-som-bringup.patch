From d57ad18a78a50b8e1ab2af7d564e572a0306bd79 Mon Sep 17 00:00:00 2001
From: Kaustubh Gondkar <kgondkar@codeaurora.org>
Date: Tue, 24 Sep 2013 07:00:37 +0000
Subject: [PATCH 1/2] APQ8064_SOM_CDP basic changes for som bringup

---
 platform/msm8960/gpio.c               | 10 ++++++++++
 target/msm8960/include/target/board.h |  4 ++++
 target/msm8960/init.c                 | 12 +++++++++++-
 target/msm8960/rules.mk               |  7 ++++---
 4 files changed, 29 insertions(+), 4 deletions(-)

diff --git a/platform/msm8960/gpio.c b/platform/msm8960/gpio.c
index 3bd7738..b295e4e 100755
--- a/platform/msm8960/gpio.c
+++ b/platform/msm8960/gpio.c
@@ -95,6 +95,16 @@ void gpio_config_uart_dm(uint8_t id)
 							 GPIO_8MA, GPIO_DISABLE);
 			break;
 
+		/* Clarence SOM: UART_2x, GSBI-6, GPIO 14,15 */
+		case GSBI_ID_6:
+			/* configure rx gpio */
+			gpio_tlmm_config(15, 1, GPIO_INPUT, GPIO_NO_PULL,
+							 GPIO_8MA, GPIO_DISABLE);
+			/* configure tx gpio */
+			gpio_tlmm_config(14, 1, GPIO_OUTPUT, GPIO_NO_PULL,
+							 GPIO_8MA, GPIO_DISABLE);
+			break;
+
 
 		case GSBI_ID_7:
 			/* configure rx gpio */
diff --git a/target/msm8960/include/target/board.h b/target/msm8960/include/target/board.h
index 9c93486..083b595 100644
--- a/target/msm8960/include/target/board.h
+++ b/target/msm8960/include/target/board.h
@@ -56,6 +56,10 @@
 #define LINUX_MACHTYPE_8064_CDP     3948
 #define LINUX_MACHTYPE_8064_MTP     3949
 #define LINUX_MACHTYPE_8064_LIQUID  3951
+
+/* Clarence SOM */
+#define LINUX_MACHTYPE_8064_SOM_CDP 3955
+
 #define LINUX_MACHTYPE_8064_MPQ_CDP 3993
 #define LINUX_MACHTYPE_8064_MPQ_HRD 3994
 #define LINUX_MACHTYPE_8064_MPQ_DTV 3995
diff --git a/target/msm8960/init.c b/target/msm8960/init.c
index e6c29c2..130d6c0 100755
--- a/target/msm8960/init.c
+++ b/target/msm8960/init.c
@@ -305,6 +305,11 @@ void target_uart_init(void)
 		uart_dm_init(7, 0x16600000, 0x16640000);
 		break;
 
+	/* Clarence SOMi: UART_2x, GSBI-6, GPIO 14,15 */
+	case LINUX_MACHTYPE_8064_SOM_CDP:
+		uart_dm_init(6, 0x16500000, 0x16540000);
+		break;
+
 	case LINUX_MACHTYPE_8064_MPQ_CDP:
 	case LINUX_MACHTYPE_8064_MPQ_HRD:
 	case LINUX_MACHTYPE_8064_MPQ_DTV:
@@ -410,7 +415,9 @@ void target_detect(struct board_data *board)
 					 || (platform == APQ8064AB)) {
 		switch (platform_hw) {
 		case HW_PLATFORM_SURF:
-			target_id = LINUX_MACHTYPE_8064_CDP;
+			/* Clarence SOM FIXME: Removed CDP, will use SOM_CDP */
+			/*target_id = LINUX_MACHTYPE_8064_CDP;*/
+			target_id = LINUX_MACHTYPE_8064_SOM_CDP;
 			break;
 		case HW_PLATFORM_MTP:
 			target_id = LINUX_MACHTYPE_8064_MTP;
@@ -427,6 +434,9 @@ void target_detect(struct board_data *board)
 		ASSERT(0);
 	}
 	board->target = target_id;
+	dprintf(CRITICAL, "Platform    : (%d)\n", platform);
+	dprintf(CRITICAL, "Platform HW : (%d)\n", platform_hw);
+	dprintf(CRITICAL, "Target ID   : (%d)\n", target_id);
 }
 
 /* Detect the modem type */
diff --git a/target/msm8960/rules.mk b/target/msm8960/rules.mk
index 8cf761c..170d380 100644
--- a/target/msm8960/rules.mk
+++ b/target/msm8960/rules.mk
@@ -16,9 +16,10 @@ SCRATCH_ADDR     := 0x90000000
 
 KEYS_USE_GPIO_KEYPAD := 1
 
-DEFINES += DISPLAY_SPLASH_SCREEN=1
-DEFINES += DISPLAY_TYPE_MIPI=1
-DEFINES += DISPLAY_TYPE_HDMI=1
+## Clarence SoM: Disabled display ##
+#DEFINES += DISPLAY_SPLASH_SCREEN=1
+#DEFINES += DISPLAY_TYPE_MIPI=1
+#DEFINES += DISPLAY_TYPE_HDMI=1
 
 MODULES += \
 	dev/keys \
-- 
1.8.2.1

